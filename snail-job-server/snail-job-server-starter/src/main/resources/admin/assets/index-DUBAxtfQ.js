import{_ as I}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CCVNa7vh.js";import{d as T,U as V,V as F,o as D,c as O,w as h,f as o,h as l,$ as t,Y as q,bv as M,n as j,a3 as G,bb as K,s as L,b as E,a9 as S,B as d,bz as H,a4 as Y,N as J,bf as Q,g as X,I as Z,aa as ee}from"./index-C0jHFrT7.js";import{c as te,d as oe,e as ae,g as le}from"./workflow-Ds6L9qGA.js";import{_ as re,u as ne,a as se,N as ie}from"./table-CCLDLnqu.js";import{_ as ue}from"./status-switch.vue_vue_type_script_setup_true_lang-D0p-CjtO.js";import{u as me}from"./auth-BpI7SjCm.js";import{_ as ce}from"./search-form.vue_vue_type_script_setup_true_lang-7J0hSeh6.js";import{_ as pe}from"./select-group.vue_vue_type_script_setup_true_lang-BxHXAe1B.js";import{N as de}from"./ButtonGroup-BC2Di0vs.js";import{b as fe}from"./Grid-CiG62sXN.js";import"./Space-DUmk9ljR.js";import"./form-W0W3zplR.js";import"./round-search-BfyTeFqd.js";import"./group-JmFGeIOM.js";const we=T({name:"WorkflowSearch",__name:"workflow-search",props:{model:{required:!0},modelModifiers:{}},emits:V(["reset","search"],["update:model"]),setup(f,{emit:y}){const m=y,u=F(f,"model");function b(){m("reset")}function k(){m("search")}return(N,n)=>{const w=re,v=j,_=G,x=ce;return D(),O(x,{model:u.value,onSearch:k,onReset:b},{default:h(()=>[o(w,{span:"24 s:12 m:6",label:l(t)("page.workflow.groupName"),path:"groupName",class:"pr-24px"},{default:h(()=>[o(pe,{modelValue:u.value.groupName,"onUpdate:modelValue":n[0]||(n[0]=s=>u.value.groupName=s)},null,8,["modelValue"])]),_:1},8,["label"]),o(w,{span:"24 s:12 m:6",label:l(t)("page.workflow.workflowName"),path:"workflowName",class:"pr-24px","label-width":100},{default:h(()=>[o(v,{value:u.value.workflowName,"onUpdate:value":n[1]||(n[1]=s=>u.value.workflowName=s),placeholder:l(t)("page.workflow.form.workflowName")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(w,{span:"24 s:12 m:6",label:l(t)("page.workflow.workflowStatus"),path:"workflowStatus",class:"pr-24px"},{default:h(()=>[o(_,{value:u.value.workflowStatus,"onUpdate:value":n[2]||(n[2]=s=>u.value.workflowStatus=s),placeholder:l(t)("page.workflow.form.workflowStatus"),options:l(q)(l(M))},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ge={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function g(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!ee(f)}const $e=T({name:"workflow_task",__name:"index",setup(f){const{hasAuth:y}=me(),m=K(),u=L(),{columns:b,columnChecks:k,data:N,getData:n,loading:w,mobilePagination:v,searchParams:_,resetSearchParams:x}=ne({apiFn:te,apiParams:{page:1,size:10,workflowName:null,groupName:null,workflowStatus:null},columns:()=>[{key:"id",title:t("common.index"),align:"center",width:120},{key:"workflowName",title:t("page.workflow.workflowName"),align:"left",minWidth:120,render:e=>{function a(){A(e.id)}return o(d,{text:!0,tag:"a",type:"primary",onClick:a,class:"ws-normal"},{default:()=>[e.workflowName]})}},{key:"groupName",title:t("page.workflow.groupName"),align:"left",minWidth:120},{key:"nextTriggerAt",title:t("page.workflow.nextTriggerAt"),align:"left",minWidth:120},{key:"workflowStatus",title:t("page.workflow.workflowStatus"),align:"left",minWidth:120,render:e=>{const a=async(r,c)=>{var i;const{error:p}=await le(e.id);p||(e.workflowStatus=r,(i=window.$message)==null||i.success(t("common.updateSuccess"))),c()};return o(ue,{value:e.workflowStatus,"onUpdate:value":r=>e.workflowStatus=r,onFetch:a},null)}},{key:"triggerType",title:t("page.workflow.triggerType"),align:"left",minWidth:120,render:e=>{if(!e.triggerType)return null;const a=t(H[e.triggerType]);return o(J,{type:Y(e.triggerType)},g(a)?a:{default:()=>[a]})}},{key:"triggerInterval",title:t("page.workflow.triggerInterval"),align:"left",minWidth:120},{key:"executorTimeout",title:t("page.workflow.executorTimeout"),align:"left",minWidth:120},{key:"updateDt",title:t("page.workflow.updateDt"),align:"left",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",fixed:"right",width:200,render:e=>{let a;return o("div",{class:"flex-center gap-8px"},[o(d,{type:"warning",ghost:!0,size:"small",onClick:()=>$(e.id)},g(a=t("common.edit"))?a:{default:()=>[a]}),y("R_ADMIN")?o(ie,{onPositiveClick:()=>R(e.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let r;return o(d,{type:"error",ghost:!0,size:"small"},g(r=t("common.delete"))?r:{default:()=>[r]})}}):"",o(Q,{trigger:"click",placement:"bottom",raw:!0,"show-arrow":!1,class:"b-rd-6px bg-#fff dark:bg-#000"},{trigger:()=>o(d,{type:"primary",ghost:!0,size:"small"},{default:()=>[X("更多")]}),default:()=>{let r,c,p;return o("div",null,[o(de,{vertical:!0},{default:()=>[o(d,{type:"primary",ghost:!0,size:"small",onClick:()=>P(e.id)},g(r=t("common.execute"))?r:{default:()=>[r]}),o(d,{type:"primary",ghost:!0,size:"small",onClick:()=>U(e.id)},g(c=t("common.copy"))?c:{default:()=>[c]}),o(d,{type:"success",ghost:!0,size:"small",onClick:()=>B(e.id)},g(p=t("common.batchList"))?p:{default:()=>[p]})]})])}})])}}]}),{checkedRowKeys:s,onBatchDeleted:W}=se(N,n);async function C(){console.log(s.value),W()}async function R(e){var r;const{error:a}=await oe(e);a||((r=window.$message)==null||r.success(t("common.deleteSuccess")),n())}function $(e){m.push({path:"/workflow/form/edit",query:{id:e}})}function z(){m.push({path:"/workflow/form/edit"})}function A(e){m.push({path:"/workflow/form/detail",query:{id:e}})}function U(e){m.push({path:"/workflow/form/copy",query:{id:e}})}function B(e){m.push({path:"/workflow/batch",query:{workflowId:e}})}async function P(e){var r;const{error:a}=await ae(e);a||((r=window.$message)==null||r.success(t("common.executeSuccess")),n())}return(e,a)=>{const r=I,c=fe,p=Z;return D(),E("div",ge,[o(we,{model:l(_),"onUpdate:model":a[0]||(a[0]=i=>S(_)?_.value=i:null),onReset:l(x),onSearch:l(n)},null,8,["model","onReset","onSearch"]),o(p,{title:l(t)("page.workflow.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":h(()=>[o(r,{columns:l(k),"onUpdate:columns":a[1]||(a[1]=i=>S(k)?k.value=i:null),"disabled-delete":l(s).length===0,loading:l(w),"show-delete":!1,onAdd:z,onDelete:C,onRefresh:l(n)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:h(()=>[o(c,{"checked-row-keys":l(s),"onUpdate:checkedRowKeys":a[2]||(a[2]=i=>S(s)?s.value=i:null),columns:l(b),data:l(N),"flex-height":!l(u).isMobile,"scroll-x":1300,loading:l(w),remote:"","row-key":i=>i.id,pagination:l(v),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"])])}}});export{$e as default};
