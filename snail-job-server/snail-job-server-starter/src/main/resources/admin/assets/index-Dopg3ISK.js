import{_ as be}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CCVNa7vh.js";import{d as te,U as Z,p as G,V as ee,Y as P,a as _e,$ as t,i as ve,aF as he,r as Se,W as fe,o as N,c as $,w as o,f as a,g as I,t as U,h as e,cn as Te,S as W,b as le,Q as se,bv as ie,R as re,a3 as de,bu as Ne,n as we,B as X,co as ue,cp as ke,cq as Ce,a4 as O,cr as me,bx as De,cs as ce,ct as ye,N as q,s as Ie,a8 as Ue,a9 as E,cu as Re,I as Le,aa as $e}from"./index-C0jHFrT7.js";import{d as Ve,e as Oe,g as xe,h as je,i as pe,j as Be}from"./notify-8ysH-Eqb.js";import{_ as Fe,u as Me,a as Ge,N as Ae}from"./table-CCLDLnqu.js";import{u as ze,a as Pe,_ as Ee,b as qe}from"./form-W0W3zplR.js";import{_ as ge}from"./operate-drawer-BhL4p7os.js";import{f as We}from"./retry-scene-CfkrljLS.js";import{f as He}from"./workflow-Ds6L9qGA.js";import{i as Ke}from"./job-BxRJab5O.js";import{_ as Je}from"./select-group.vue_vue_type_script_setup_true_lang-BxHXAe1B.js";import{_ as Qe}from"./Space-DUmk9ljR.js";import{_ as Ye,f as Xe,e as Ze,a as et,b as tt}from"./Grid-CiG62sXN.js";import{_ as at}from"./search-form.vue_vue_type_script_setup_true_lang-7J0hSeh6.js";import{_ as ot,a as nt}from"./DescriptionsItem-7KqcbMhz.js";import{_ as lt}from"./status-switch.vue_vue_type_script_setup_true_lang-D0p-CjtO.js";import{u as st}from"./auth-BpI7SjCm.js";import"./close-fullscreen-rounded-Df-k0Dlo.js";import"./group-JmFGeIOM.js";import"./round-search-BfyTeFqd.js";const it=te({name:"NotifyConfigOperateDrawer",__name:"notify-config-operate-drawer",props:Z({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{},retrySceneDisable:{type:Boolean,default:!0},retrySceneDisableModifiers:{}}),emits:Z(["update:value","submitted"],["update:visible","update:retrySceneDisable"]),setup(S,{emit:x}){const R=G([]),f=G([]),C=G([]),g=G([]),y=S,v=x,h=ee(S,"visible"),d=ee(S,"retrySceneDisable"),w=G(P(ue)),{formRef:i,validate:m,restoreValidation:ae}=ze(),{defaultRequiredRule:D}=Pe(),oe=_e(()=>({add:t("page.notifyConfig.addNotifyConfig"),edit:t("page.notifyConfig.editNotifyConfig")})[y.operateType]);ve(()=>{he(()=>{ne()})});async function ne(){const c=await Ve();R.value=c.data}const n=Se(H());function H(){return{groupName:null,businessId:"",recipientIds:[],systemTaskType:null,notifyStatus:1,notifyScene:null,notifyThreshold:16,rateLimiterStatus:0,rateLimiterThreshold:100,description:""}}const j={groupName:D,businessId:D,notifyStatus:D,notifyScene:D,recipientIds:D,rateLimiterStatus:D,notifyThreshold:D};function K(){if(y.operateType==="add"){Object.assign(n,H()),d.value=!0;return}y.operateType==="edit"&&y.rowData&&(Object.assign(n,y.rowData),r(n.systemTaskType),l(n.notifyScene))}function J(){h.value=!1}async function Q(){var c;if(await m(),y.operateType==="add"){const{groupName:s,businessId:u,recipientIds:T,systemTaskType:V,notifyStatus:L,notifyScene:k,notifyThreshold:b,rateLimiterStatus:B,rateLimiterThreshold:F,description:A}=n,{error:z}=await Oe({groupName:s,businessId:u,recipientIds:T,systemTaskType:V,notifyStatus:L,notifyScene:k,notifyThreshold:b,rateLimiterStatus:B,rateLimiterThreshold:F,description:A});if(z)return}if(y.operateType==="edit"){const{id:s,groupName:u,businessId:T,recipientIds:V,notifyStatus:L,systemTaskType:k,notifyScene:b,notifyThreshold:B,rateLimiterStatus:F,rateLimiterThreshold:A,description:z}=n,{error:Y}=await xe({id:s,groupName:u,businessId:T,recipientIds:V,systemTaskType:k,notifyStatus:L,notifyScene:b,notifyThreshold:B,rateLimiterStatus:F,rateLimiterThreshold:A,description:z});if(Y)return}(c=window.$message)==null||c.success(t("common.updateSuccess")),J(),v("submitted")}async function r(c){var s,u,T,V,L;if(c===1){const k=await We({groupName:n.groupName});f.value=k.data,w.value=P(ue)}else if(c===3){const k=await Ke({groupName:n.groupName});C.value=(s=k.data)==null?void 0:s.map(b=>(b.id=String(b.id),b)),w.value=P(ke)}else if(c===4){const k=await He({groupName:n.groupName});g.value=(u=k.data)==null?void 0:u.map(b=>(b.id=String(b.id),b)),w.value=P(Ce)}c!==((T=y.rowData)==null?void 0:T.systemTaskType)?(n.businessId=null,n.notifyScene=null):(n.businessId=(V=y.rowData)==null?void 0:V.businessId,n.notifyScene=(L=y.rowData)==null?void 0:L.notifyScene)}async function l(c){d.value=!(c===5||c===6)}function _(c){K(),n.groupName=c,r(1),l(1)}return fe(h,()=>{h.value&&(K(),ae())}),(c,s)=>{const u=Ee,T=de,V=et,L=Qe,k=Ye,b=Xe,B=Ne,F=Ze,A=we,z=qe,Y=X;return N(),$(ge,{modelValue:h.value,"onUpdate:modelValue":s[12]||(s[12]=p=>h.value=p),title:oe.value,"min-size":480,onHandleSubmit:Q},{footer:o(()=>[a(L,{size:16},{default:o(()=>[a(Y,{onClick:J},{default:o(()=>[I(U(e(t)("common.cancel")),1)]),_:1}),a(Y,{type:"primary",onClick:Q},{default:o(()=>[I(U(e(t)("common.save")),1)]),_:1})]),_:1})]),default:o(()=>[a(z,{ref_key:"formRef",ref:i,model:n,rules:j},{default:o(()=>[a(u,{label:e(t)("page.notifyConfig.groupName"),path:"groupName"},{default:o(()=>[a(Je,{modelValue:n.groupName,"onUpdate:modelValue":[s[0]||(s[0]=p=>n.groupName=p),_]},null,8,["modelValue"])]),_:1},8,["label"]),a(u,{label:e(t)("page.notifyConfig.systemTaskType"),path:"systemTaskType"},{default:o(()=>[a(T,{value:n.systemTaskType,"onUpdate:value":[s[1]||(s[1]=p=>n.systemTaskType=p),r],placeholder:e(t)("page.notifyConfig.form.systemTaskType"),options:e(P)(e(Te)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),n.systemTaskType===1?(N(),$(u,{key:0,label:e(t)("page.notifyConfig.retryScene"),path:"businessId"},{default:o(()=>[a(T,{value:n.businessId,"onUpdate:value":s[2]||(s[2]=p=>n.businessId=p),placeholder:e(t)("page.notifyConfig.form.sceneName"),options:f.value,"label-field":"sceneName","value-field":"sceneName",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])):W("",!0),n.systemTaskType===3?(N(),$(u,{key:1,label:e(t)("page.notifyConfig.job"),path:"businessId"},{default:o(()=>[a(T,{value:n.businessId,"onUpdate:value":s[3]||(s[3]=p=>n.businessId=p),placeholder:e(t)("page.notifyConfig.form.jobName"),options:C.value,"label-field":"jobName","value-field":"id",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])):W("",!0),n.systemTaskType===4?(N(),$(u,{key:2,label:e(t)("page.notifyConfig.workflow"),path:"businessId"},{default:o(()=>[a(T,{value:n.businessId,"onUpdate:value":s[4]||(s[4]=p=>n.businessId=p),placeholder:e(t)("page.notifyConfig.form.workflowName"),options:g.value,"label-field":"workflowName","value-field":"id",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])):W("",!0),a(u,{label:e(t)("page.notifyConfig.notifyScene"),path:"notifyScene"},{default:o(()=>[a(T,{value:n.notifyScene,"onUpdate:value":[s[5]||(s[5]=p=>n.notifyScene=p),l],placeholder:e(t)("page.notifyConfig.form.notifyScene"),options:w.value,clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(u,{label:e(t)("page.notifyConfig.notifyRecipient"),path:"recipientIds"},{default:o(()=>[a(T,{value:n.recipientIds,"onUpdate:value":s[6]||(s[6]=p=>n.recipientIds=p),placeholder:e(t)("page.notifyConfig.form.notifyRecipient"),options:R.value,clearable:"",multiple:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(F,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:o(()=>[a(b,null,{default:o(()=>[a(u,{label:e(t)("page.notifyConfig.notifyStatus"),path:"notifyStatus"},{default:o(()=>[a(k,{value:n.notifyStatus,"onUpdate:value":s[7]||(s[7]=p=>n.notifyStatus=p),name:"notifyStatus"},{default:o(()=>[a(L,null,{default:o(()=>[(N(!0),le(re,null,se(e(ie),p=>(N(),$(V,{key:p.value,value:p.value,label:e(t)(p.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),a(b,null,{default:o(()=>[a(u,{label:e(t)("page.notifyConfig.notifyThreshold"),path:"notifyThreshold"},{default:o(()=>[a(B,{value:n.notifyThreshold,"onUpdate:value":s[8]||(s[8]=p=>n.notifyThreshold=p),min:1,placeholder:e(t)("page.notifyConfig.form.notifyThreshold"),disabled:d.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1}),a(F,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:o(()=>[a(b,null,{default:o(()=>[a(u,{label:e(t)("page.notifyConfig.rateLimiterStatus"),path:"rateLimiterStatus"},{default:o(()=>[a(k,{value:n.rateLimiterStatus,"onUpdate:value":s[9]||(s[9]=p=>n.rateLimiterStatus=p),name:"rateLimiterStatus",disabled:d.value},{default:o(()=>[a(L,null,{default:o(()=>[(N(!0),le(re,null,se(e(ie),p=>(N(),$(V,{key:p.value,value:p.value,label:e(t)(p.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value","disabled"])]),_:1},8,["label"])]),_:1}),a(b,null,{default:o(()=>[a(u,{label:e(t)("page.notifyConfig.rateLimiterThreshold"),path:"notifyThreshold"},{default:o(()=>[a(B,{value:n.rateLimiterThreshold,"onUpdate:value":s[10]||(s[10]=p=>n.rateLimiterThreshold=p),min:1,placeholder:e(t)("page.notifyConfig.form.notifyThreshold"),disabled:d.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1}),a(u,{label:e(t)("page.notifyConfig.description"),path:"description"},{default:o(()=>[a(A,{value:n.description,"onUpdate:value":s[11]||(s[11]=p=>n.description=p),type:"textarea",placeholder:e(t)("page.notifyConfig.form.description")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),rt=te({name:"NotifyConfigSearch",__name:"notify-config-search",props:{model:{required:!0},modelModifiers:{}},emits:Z(["reset","search"],["update:model"]),setup(S,{emit:x}){const R=x,f=ee(S,"model");function C(){R("reset")}function g(){R("search")}return(y,v)=>{const h=de,d=Fe,w=at;return N(),$(w,{model:f.value,onSearch:g,onReset:C},{default:o(()=>[a(d,{span:"24 s:12 m:6",label:e(t)("page.notifyConfig.groupName"),path:"groupName",class:"pr-24px"},{default:o(()=>[a(h,{value:f.value.groupName,"onUpdate:value":v[0]||(v[0]=i=>f.value.groupName=i),placeholder:e(t)("page.notifyConfig.groupName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{span:"24 s:12 m:6",label:e(t)("page.notifyConfig.notifyStatus"),path:"notifyStatus",class:"pr-24px"},{default:o(()=>[a(h,{value:f.value.notifyStatus,"onUpdate:value":v[1]||(v[1]=i=>f.value.notifyStatus=i),placeholder:e(t)("page.notifyConfig.notifyStatus"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{span:"24 s:12 m:6",label:e(t)("page.notifyConfig.notifyScene"),path:"notifyScene",class:"pr-24px"},{default:o(()=>[a(h,{value:f.value.notifyScene,"onUpdate:value":v[2]||(v[2]=i=>f.value.notifyScene=i),placeholder:e(t)("page.notifyConfig.notifyScene"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ut=te({name:"NotifyConfigDetailDrawer",__name:"notify-config-detail-drawer",props:Z({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(S){const x=S,R=ee(S,"visible");return fe(()=>x.rowData,()=>{console.log(x.rowData)},{immediate:!0}),(f,C)=>{const g=ot,y=q,v=nt,h=ge;return N(),$(h,{modelValue:R.value,"onUpdate:modelValue":C[0]||(C[0]=d=>R.value=d),title:e(t)("page.groupConfig.detail")},{default:o(()=>[a(v,{"label-placement":"top",bordered:"",column:2},{default:o(()=>{var d,w;return[a(g,{label:e(t)("page.notifyConfig.businessName"),span:2},{default:o(()=>{var i;return[I(U((i=f.rowData)==null?void 0:i.businessName),1)]}),_:1},8,["label"]),a(g,{label:e(t)("page.groupConfig.groupName"),span:2},{default:o(()=>{var i;return[I(U((i=f.rowData)==null?void 0:i.groupName),1)]}),_:1},8,["label"]),a(g,{label:e(t)("page.notifyConfig.systemTaskType"),span:1},{default:o(()=>{var i;return[a(y,{type:e(O)((i=f.rowData)==null?void 0:i.systemTaskType)},{default:o(()=>{var m;return[I(U(e(t)(e(me)[(m=f.rowData)==null?void 0:m.systemTaskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(g,{label:e(t)("page.notifyConfig.notifyStatus"),span:1},{default:o(()=>{var i;return[a(y,{type:e(O)((i=f.rowData)==null?void 0:i.notifyStatus)},{default:o(()=>{var m;return[I(U(e(t)(e(De)[(m=f.rowData)==null?void 0:m.notifyStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),((d=f.rowData)==null?void 0:d.systemTaskType)===1?(N(),$(g,{key:0,label:e(t)("page.notifyConfig.notifyScene"),span:1},{default:o(()=>{var i;return[a(y,{type:e(O)((i=f.rowData)==null?void 0:i.notifyScene)},{default:o(()=>{var m;return[I(U(e(t)(e(ce)[(m=f.rowData)==null?void 0:m.notifyScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"])):W("",!0),((w=f.rowData)==null?void 0:w.systemTaskType)===3?(N(),$(g,{key:1,label:e(t)("page.notifyConfig.notifyScene"),span:1},{default:o(()=>{var i;return[a(y,{type:e(O)((i=f.rowData)==null?void 0:i.notifyScene)},{default:o(()=>{var m;return[I(U(e(t)(e(ye)[(m=f.rowData)==null?void 0:m.notifyScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"])):W("",!0),a(g,{label:e(t)("page.notifyConfig.notifyThreshold"),span:1},{default:o(()=>{var i;return[a(y,{type:e(O)((i=f.rowData)==null?void 0:i.notifyThreshold)},{default:o(()=>{var m;return[I(U((m=f.rowData)==null?void 0:m.notifyThreshold),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(g,{label:e(t)("common.createDt"),span:2},{default:o(()=>{var i;return[I(U((i=f.rowData)==null?void 0:i.createDt),1)]}),_:1},8,["label"]),a(g,{label:e(t)("page.notifyConfig.description"),span:2},{default:o(()=>{var i;return[I(U((i=f.rowData)==null?void 0:i.description),1)]}),_:1},8,["label"])]}),_:1})]),_:1},8,["modelValue","title"])}}}),pt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function M(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!$e(S)}const Rt=te({name:"notify_scene",__name:"index",setup(S){const{hasAuth:x}=st(),R=Ie(),f=G(),{bool:C,setTrue:g}=Ue(!1),{columns:y,columnChecks:v,data:h,getData:d,loading:w,mobilePagination:i,searchParams:m,resetSearchParams:ae}=Me({apiFn:je,apiParams:{page:1,size:10,groupName:null,notifyStatus:null,notifyScene:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:t("common.index"),align:"center",width:64},{key:"businessName",title:t("page.notifyConfig.businessName"),align:"left",width:120,render:r=>{function l(){f.value=r||null,g()}return a(X,{text:!0,tag:"a",type:"primary",onClick:l,class:"ws-normal"},{default:()=>[r.businessName]})}},{key:"groupName",title:t("page.notifyConfig.groupName"),align:"left",width:120},{key:"systemTaskType",title:t("page.notifyConfig.systemTaskType"),align:"left",width:120,render:r=>{if(r.systemTaskType===null)return null;const l=t(me[r.systemTaskType]);return a(q,{type:O(r.systemTaskType)},M(l)?l:{default:()=>[l]})}},{key:"notifyStatus",title:t("page.notifyConfig.notifyStatus"),align:"left",width:120,render:r=>{const l=async(_,c)=>{var u;const{error:s}=await Be(r.id,_);s||(r.notifyStatus=_,(u=window.$message)==null||u.success(t("common.updateSuccess"))),c()};return a(lt,{value:r.notifyStatus,"onUpdate:value":_=>r.notifyStatus=_,onFetch:l},null)}},{key:"notifyScene",title:t("page.notifyConfig.notifyScene"),align:"left",width:160,render:r=>{if(r.notifyScene===null)return null;if(r.systemTaskType===1){const l=t(ce[r.notifyScene]);return a(q,{type:O(r.notifyScene)},M(l)?l:{default:()=>[l]})}if(r.systemTaskType===3){const l=t(ye[r.notifyScene]);return a(q,{type:O(r.notifyScene)},M(l)?l:{default:()=>[l]})}if(r.systemTaskType===4){const l=t(Re[r.notifyScene]);return a(q,{type:O(r.notifyScene)},M(l)?l:{default:()=>[l]})}return null}},{key:"notifyThreshold",title:t("page.notifyConfig.notifyThreshold"),align:"left",width:120},{key:"createDt",title:t("common.createDt"),align:"left",width:120},{key:"description",title:t("page.notifyConfig.description"),align:"left",width:120},{key:"operate",title:t("common.operate"),align:"center",width:130,render:r=>{let l;return a("div",{class:"flex-center gap-8px"},[a(X,{type:"primary",ghost:!0,size:"small",onClick:()=>Q(r.id)},M(l=t("common.edit"))?l:{default:()=>[l]}),x("R_ADMIN")?a(Ae,{onPositiveClick:()=>J(r.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let _;return a(X,{type:"error",ghost:!0,size:"small"},M(_=t("common.delete"))?_:{default:()=>[_]})}}):""])}}]}),{drawerVisible:D,operateType:oe,editingData:ne,handleAdd:n,handleEdit:H,checkedRowKeys:j}=Ge(h,d);async function K(){var l;const{error:r}=await pe(j.value);r||((l=window.$message)==null||l.success(t("common.deleteSuccess")),d())}async function J(r){var _;const{error:l}=await pe([r]);l||((_=window.$message)==null||_.success(t("common.deleteSuccess")),d())}function Q(r){H(r)}return(r,l)=>{const _=be,c=tt,s=Le;return N(),le("div",pt,[a(rt,{model:e(m),"onUpdate:model":l[0]||(l[0]=u=>E(m)?m.value=u:null),onReset:e(ae),onSearch:e(d)},null,8,["model","onReset","onSearch"]),a(s,{title:e(t)("page.notifyConfig.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":o(()=>[a(_,{columns:e(v),"onUpdate:columns":l[1]||(l[1]=u=>E(v)?v.value=u:null),"disabled-delete":e(j).length===0,loading:e(w),onAdd:e(n),onDelete:K,onRefresh:e(d)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:o(()=>[a(c,{"checked-row-keys":e(j),"onUpdate:checkedRowKeys":l[2]||(l[2]=u=>E(j)?j.value=u:null),columns:e(y),data:e(h),"flex-height":!e(R).isMobile,"scroll-x":962,loading:e(w),remote:"","row-key":u=>u.id,pagination:e(i),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(it,{visible:e(D),"onUpdate:visible":l[3]||(l[3]=u=>E(D)?D.value=u:null),"operate-type":e(oe),"row-data":e(ne),onSubmitted:e(d)},null,8,["visible","operate-type","row-data","onSubmitted"]),a(ut,{visible:e(C),"onUpdate:visible":l[4]||(l[4]=u=>E(C)?C.value=u:null),"row-data":f.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{Rt as default};
